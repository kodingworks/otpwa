services:
  redis-server:
    image: redis
    container_name: redis-server
    ports:
      - '6379:6379'
    volumes:
      - ./redis-service/config/redis.conf:/redis.conf
    command: ['redis-server', '/redis.conf']

  otpwa:
    build:
      context: ./
      dockerfile: ./Dockerfile
    image: arifwidiantokodingworks/otpwa:latest
    environment:
      - TZ=${TZ}
      - PORT=${PORT}
      - DB_URL=${DB_URL}
      - DB_NAME=${DB_NAME}
      - REDIS_TTL=${REDIS_TTL}
      - ENCRYPTION_ALGORITHM=sha256
      - ENCRYPTION_SECRET=${ENCRYPTION_SECRET}
      - TOKEN=${TOKEN}
      - REDIS_HOST=redis-server
      - REDIS_PORT=6379
    ports:
      - '3000:3000' # expose-to-the-world : only-in-the-docker
    container_name: otpwa-app
    # depends_on:
    # -
    volumes:
      - ./otpwa
      - ./node_modules

volumes:
  redis-data:
